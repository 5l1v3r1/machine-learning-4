#!/bin/bash
# note: this file is executed from 'bash_loader' , this is why the
#       directory paths seem to be too short (i.e. missing extra '..')


# Pre-Pathing: allow 'imagemin' command
PATH="/usr/local/bin:$PATH"


# create directory if doesn't exist
mkdir -p ../html/machine-learning/asset/img/


# track execution of script
set -x; exec > log/bash_web_img 2>&1


# allow 'extglob'
shopt -s extglob


# watch '../src/img/' subdirectory
inotifywait ../src/img/ -m -e close_write -e move -e create |
  # Minify Images
  for file_with_path in ../src/img/"!(*.gif)"; do
    # filename (without extension)
    file="${file_with_path##*/}"
    file_extension="${filename##*.}"

    # minify with 'imagemin'
    if [ file_extension = 'gif' ]; then
      cp $file_with_path ../html/machine-learning/asset/img/$file
    else
      imagemin $file_with_path > ../html/machine-learning/asset/img/$file
    fi
  done
