#!/bin/bash

# @web_img: is executed from 'bash_loader', which is why the directory
#           paths seem shorter in this file (i.e. missing extra '../').
#
# Note: minifid GIF files lose their animated quality. This script minifies
#       all images except GIF (copied to the 'asset/').


# Pre-Pathing: allow 'imagemin' command
PATH="/usr/local/bin:$PATH"


# create directory if doesn't exist
mkdir -p ../html/machine-learning/asset/img/
mkdir -p ../log/build/

# track execution of script
set -x; exec > ../log/build/bash_web_img 2>&1


# watch '../src/img/' subdirectory
inotifywait ../src/img/ -m -e close_write -e move -e create |
  # Minify Images
  while read path action file; do
    # filename (without directory path)
    filename="${file##*/}"
    file_extension="${file##*.}"

    # minify with 'imagemin'
    if [ "$file_extension" = 'gif' ]; then
      cp ../src/img/"$file" ../html/machine-learning/asset/img/"$filename"
    else
      imagemin ../src/img/"$file" > ../html/machine-learning/asset/img/"$filename"
    fi
  done
