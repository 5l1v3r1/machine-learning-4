language: python
dist: trusty
sudo: required

## install puppet (i.e. puppet parser validate)
before_install:
  - chmod u+x linter
  - chmod u+x unit-tests
  - wget https://apt.puppetlabs.com/puppetlabs-release-pc1-trusty.deb
  - sudo dpkg -i puppetlabs-release-pc1-trusty.deb
  - sudo apt-get update
  - sudo apt-get install puppet-agent -y
  - sudo /opt/puppetlabs/bin/puppet -V

## install packages for linting
##
## @trusty-backports, allows additional packages (i.e. shellcheck) to be installed
##
install:
  - sudo add-apt-repository "deb http://archive.ubuntu.com/ubuntu/ trusty-backports restricted main universe"
  - pip install python-coveralls==2.9.0
  - ./linter install

## linting and unit test
script:
  - PROJECT_DIRECTORY=$(pwd)
  - cd test
  - ./linter run "$PROJECT_DIRECTORY"
  - ./unit-tests "$PROJECT_DIRECTORY"
  - cd "$PROJECT_DIRECTORY"

## post build: the following commands are run after a successful build.
##
## Note: more information regarding the coverage-coverall implementation:
##
##       https://github.com/pytest-dev/pytest-cov/issues/146
##
after_success:
  - coverage combine
  - coveralls
