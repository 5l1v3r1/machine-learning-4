FROM ubuntu:14.04

## install git, and wget
RUN apt-get update -y
RUN apt-get install git -y
RUN apt-get install wget -y

## install openssh
RUN apt-get install openssh-client

## private github deploy ssh-key (readonly)
RUN mkdir ~/.ssh && chmod 700 ~/.ssh
RUN eval $(ssh-agent -s)
RUN ssh-agent -s
RUN echo '-----BEGIN RSA PRIVATE KEY-----MIIJKgIBAAKCAgEAvi/5HqBqhAj1aUFJeTWi4g2r9Sn9DWPqX6w/s+nSSpH6jCg+BWlezqo0ZoxcGgM5UbV28CaHt71Bwv6uuWZTWPSy6AjsjvymY92SMQCgbuw+XPfBJMIIJ8Sn9OUi2FjmtBRTyUwOeq4UgvgYWzO7QFfOxebASbqH2IMQhkNTSzskqldn\n\wopkNUCz1maRuH7FRkdpz21hjO4AOLLQPwiH6IdXsTXEjvOisvwDzPK8nNvNMvKWyksS2l++R/ckDiRSnvYawuFGX0U2CeZ5oX8kIhe4zuMvL7Ragonwkr7e811xn1dFSQTXJwHFBWmsVfbcNY4lE16toLt7lvVrnvRm8+jqTWo5Z6ke1nT/R/GP13D7ssL2pxlaxHvHRlLY949ZEiYjMUJaUa4wEfSwLIfyeofhdlyhii0OWJpD6qHo+EDvBj8JM1IByog89tQA5lqcPaABDDlB0kb3ZP/cJ4ttiX8js7IPa6lO7nVlJ7Ul2jSoh1QpRNpxaGV17kdAg0GMB0jqlAzWFzodoHZJbLUw8ElkEX2m9DOVpFPcRlkpaLM19h6VpUVy1Hatw5T0hG/xqmOGpFz4UPpOIS292ys9/4Dma2ihUuiciC/YONfrY+hJmrGCd5n+R2tMGdl6P/Jy3W6axmI7TUy+3oFBQIw3wkJdKEAF1obZbOzhm5pu2MsCAwEAAQKCAgEAqcfXw8B+9hmtQ2Y1+g+otdZwoO736WE91GTHhYwB3/ILUd2G6HvVV/bXyogYnFwuakPtxpsO4zb/otyLDBVN6Iahw8RbsZXX0CT3oekmT390eLfv4ymX8DB9o4B+J9bNNQtEdNoBvwDybKyfyaMX0WvRuhexpt/u75ipQsKNdAZ7R9m5VhEHPgbhxE9SXPpGj+OmkLbbs9yvs+3lO7AY67sOzLLsIpVatB+IIQi82ebae1XWyQZV8T4xdrsoo7tHSoL3BuvmT5xQjmwCPupqTkkRARgMgrClcA1GByp/i4/qo81bm8DHdRn+UUOxxhgXI3QeovkNVQSpYuz6Qy95S07ir7AkcxKaNCIi1eqbiyor3Xt4w6/Q4aJt5vkLSE3UwHZYkwyx4gxivhnp30z/B3xel8Zjr3rSob5GhPlDB1fV5Qi1+zHd/Rwsm/9qhJpmlq12nUZuelSaDDmcwStebf+aQPNPTQj45UwH/I+7RTrRkcr3hS4ZVuehn2AdnPB5C6F0bl6K/rqsIfr26qUB0QsC5PxB9SBJ6KmYOJ84AWXZuQsZD9S4ljfahSL6Vvk/yCe9d/e0hhQAXOPdjSUFC7PHVZse9Ravhdd9e+8MYAiPBBdat9CX06LNX8N5Q3eC1nBwFfnhVHy/iaA30t1tErdRRSdT9+IAYXX2ULps/cECggEBAPL2hdZe1t4B2i1VkZsbxiB88jWPwQdYhF4Z2FYq3qUXysTmitL+HvCOJ/bsYjssOTm5cwmMRxoipuy0StKUlZeTzLjSydfXdz8c/lxoqNn8V3xz4FQqJqIJio/QKfM7IYddZPLJ5fMJ+ESmSgYHnimezuQqctX8h0RtURTeAKBvvY82ij8RauR8u9cDy91me/6cdOFhvMVAaaTaAm/YbIb9LH0EBbt2ZKNGDop3s5CqMCxxdBFxUvKInH9fiVIQzX8pAWtmhXH8xWawp/+/4KT/7zq7kEoeac0TRUWrde9Too+T+WrlMR/qjNvzs8O3aUJPFkWl4mDx1UyAPSDLsGECggEBAMhkfrbYeRuIbEz0Cr0Q10xgoaL3+oG1gw3PEFfQ37Ku9W1Ra3nIiYJ03Tc7HU6xpLpjhZSN91L0QBySPWWoFvwIt5k3U7M14JSaOylQzXVxoUqdyp99R48DlFB1cz5HM8LlzAwM//1UueOoYG05qnsa0Wg/wUpxim3dOYGrBidRRvZPjR5U+l9AUZFZVo+9FzaNGZjbirVHwJc+tc3uNbWZwOOnjNRZY9SBKj8C5WnaqS58dfAU94+PgDVKgawUbhyyycRKayShL194qt1FS0I07jasg1SVlBqH8v90QHsRM6MQaqc4brfGamwF62FYOe5a93ROsM+F3i2+FSX9CKsCggEBAKsr+4bYMlEexPODgZ3hp2hkHtCVgs0GE9uoIb4zXcC6TmUCd3PHDU01Gfrg9yPxOC/u85kad012dFv3eW96txmfS3A7MXEboCua5al9ItjQ62IG0Vj6iVVHm5NOeP+f/TM9HU3f6F2d/IeBEE3HOCric6hUL6uKylHvIlytO4vMraQkLKnaP5DSQBRv3EUTWvA6ki3nifL+Om+mGGlr9Kn13E4Hc3JrKuPNC5mKU7vr6xykob1YNbQhgwBJ8pkatWyNGy7rf8Ca8Qg0FWgdastUdNrQIgvV+Xw9w2QeNGx0Y+b7vZEN/9oYiTy9KT0ODt5kkbBn+mGKf1fyUR614oECggEAM3CQknEZDXdEjbBrfULwcVuwwjuzo04ruQS5JkGo2p5Mw+YNl7JhkgpbqszS5ht1tJ7NcGfM4A9w0aS8e/bdB49ZScxJAQzIfHzmyOFEDGzBwXylwbEQCGcb0FeF4Ku4XsRMT5+aqrXwDb9wGTmfSICG1qLfBDQHG9KY628yYi9b7uhWyj14E7FX/t6W+MjKR6eKtZFNluE3T9u6IYWPZfF08TtWTEAx/x+0733X1AdcPGGYiKtpLQHiIEvi44BPD7DZWDjeLgXuOiyod6pM+k7KA2DfSXwoC3NwbiCyWKT+w1H4frpeuXAGa3pNhKx4GnZhZQq6Gls7wDQ2C41bhwKCAQEA48BTL+43F3jpqkMSE6hv17x8sz48kTuFDVOzk70xZQnhR2sKLIINJd6P45Yodg81ap636P5hVgPtSjZshBsSpw0JXEHylolJaly4B5xEQuNNrYmhJmqMOfhKkF2D4ZgAGgT+Xdm6OG3p2IkNBRkcDeiyhTDkdnQ+PSqTJFRre+vnqCfHnw+yWmg+oXq+ebJq+mQMxu60KuTZ+04P1b0luAYmykPhYKLuqWECaPQSRn9n2wBx79mA/HK434Mfap1fcmrfmbKCBYMQkzpTC5VoqvOGgmwKzzmuE3g4RMNsB/bxOjb2dW5xpBeH34B1CtgBA4rmt1McLtn5bAyNZlKSBg==-----END RSA PRIVATE KEY-----' >> ~/.ssh/id_rsa

## test ssh connection to github
RUN ssh -vv -T git@github.com

## install puppet
RUN wget https://apt.puppetlabs.com/puppetlabs-release-trusty.deb
RUN dpkg -i puppetlabs-release-trusty.deb
RUN apt-get update -y

## install r10k
RUN apt-get install rubygems-integration -y
RUN gem install r10k

## clone repository: allow puppet manifests to run (below)
RUN git clone https://jeff1evesque@github.com/jeff1evesque/machine-learning.git /var/machine-learning

## install puppet modules using puppetfile with r10k
RUN PUPPETFILE=/var/machine-learning/puppet/Puppetfile PUPPETFILE_DIR=/var/machine-learning/puppet/modules/ r10k puppetfile install

## provision with puppet
RUN for x in $(find . -name '/var/machine-learning/puppet/manifests/*.pp'); do puppet apply $x; done;
